<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Photo Re‑order</title>

  <!-- SortableJS (CDN, tiny and no install needed) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    body {font-family: system-ui, sans-serif; margin: 2rem;}
    #gallery {display: flex; flex-wrap: wrap; gap: 12px; list-style: none; padding: 0;}
    #gallery li {cursor: grab;}
    #gallery img {display: block; width: 150px; height: auto; border: 1px solid #ccc; border-radius: 4px;}
    #actions {margin-top: 1.5rem;}
  </style>
</head>
<body>

  <ul id="gallery"></ul>

  <section id="actions">
    <button id="commitBtn">Commit order</button>
    <!-- This link becomes visible after “Commit” is pressed -->
    <a id="downloadLink" style="display:none; margin-left: 1rem;"></a>
  </section>

  <script>
  (async () => {
    /* 1. Load the existing JSON */
    const response  = await fetch('./docs/photos.json');
    const photos    = await response.json();

    /* 2. Render thumbnails */
    const gallery   = document.getElementById('gallery');
    Object.entries(photos).forEach(([filename, meta]) => {
      const li  = document.createElement('li');
      li.dataset.filename = filename;

      const img = document.createElement('img');
      img.src   = meta.thumbnail_url || meta.small_url || meta.url;
      img.alt   = meta.title || filename;

      li.appendChild(img);
      gallery.appendChild(li);
    });

    /* 3. Make the list sortable (drag‑and‑drop) */
    new Sortable(gallery, { animation: 150 });

    /* 4. Commit button logic */
    document.getElementById('commitBtn').addEventListener('click', () => {
      /* Update / add a `sort` field on each item */
      Array.from(gallery.children).forEach((li, index) => {
        const key         = li.dataset.filename;
        photos[key].sort  = index;            // <-- new field tracking order
      });

      /* Offer the updated JSON for download */
      const blob     = new Blob([JSON.stringify(photos, null, 2)], {type: 'application/json'});
      const url      = URL.createObjectURL(blob);
      const link     = document.getElementById('downloadLink');

      link.href        = url;
      link.download    = 'photos.json';
      link.textContent = 'Download updated photos.json';
      link.style.display = 'inline';

      alert('Order committed. Use the link to save the new JSON.');
    });
  })();
  </script>
</body>
</html>
